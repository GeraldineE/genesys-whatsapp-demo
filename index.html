<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Genesys WhatsApp Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"
    />
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <script
      src="//sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"
      defer
    ></script>
    <script
      src="//cdn.jsdelivr.net/npm/handlebars@4.7.8/dist/handlebars.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@alpinejs/mask@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <script
      src="//cdn.jsdelivr.net/npm/alpinejs@3.13.6/dist/cdn.min.js"
      integrity="sha256-FTz1HAldsuHyr3y8w3VLPMUBshrpsxllBIGs9e+Wzzc="
      crossorigin="anonymous"
      defer
    ></script>

    <main
      x-data
      :style="{ 
        fontFamily: `'Inter', sans-serif`,
        fontOpticalSizing: 'auto',
        fontStyle: 'normal',
        fontVariationSettings: `'slnt' 0`,
        maxWidth: '31.25rem',
        padding: '1rem'
      }"
    >
      <div x-data x-show="$store.auth.status === 'authenticating'" x-cloak>
        Authenticating...
      </div>
      <div x-data x-show="$store.auth.status === 'success'" x-cloak>
        <div
          x-data
          :style="{
            display: 'flex',
            justifyContent: 'flex-start'
          }"
        >
          <img
            src="https://dist.monitoreointeligente.informationsys.com/agentless-wa/logo-monitoreo_inteligente-transparente.png"
            alt="Monitoreo Inteligente"
            width="200"
          />
        </div>
        <div
          x-data
          :style="{
            display: 'flex',
            flexDirection: 'column',
            gap: '2rem',
            marginTop: '1rem',
            marginBottom: '1rem'
          }"
        >
          <div
            x-data="tabs($store.app.selectedTabIndex)"
            x-modelable="selectedTabIndex"
            x-model="$store.app.selectedTabIndex"
            role="tablist"
            :style="{
              display: 'inline-flex',
              alignItems: 'center',
              justifyContent: 'center',
              padding: '0.25rem',
              backgroundColor: '#f4f4f5',
              borderRadius: '0.5rem'
            }"
          >
            <template x-data x-for="(tab, tabIndex) in $store.app.tabs">
              <button
                role="tab"
                type="button"
                @click="setSelectedTabIndex(tabIndex)"
                :style="{
                  flex: '1',
                  display: 'inline-flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '0.875rem',
                  fontWeight: '500',
                  lineHeight: '1.25rem',
                  color: tabIndex === selectedTabIndex ? '#09090b' : '#52525b',
                  padding: '0.25rem 0.75rem',
                  whiteSpace: 'nowrap',
                  backgroundColor: tabIndex === selectedTabIndex ? '#ffffff' : 'none',
                  border: 0,
                  borderRadius: 'calc(0.5rem - 0.125rem)',
                  cursor: 'pointer',
                }"
                x-text="tab.label"
              ></button>
            </template>
          </div>

          <div x-data x-show="$store.app.selectedTabIndex === 0">
            <div
              x-data
              :style="{
                display: 'flex',
                flexDirection: 'column',
                gap: '1rem' 
              }"
            >
              <select
                x-model.number="$store.app.selectedTemplateIndex"
                :style="{
                  appearance: 'none',
                  fontSize: '0.875rem',
                  fontWeight: '400',
                  lineHeight: '1.25rem',
                  color: '#09090b',
                  padding: '0.5rem 0.75rem',
                  paddingRight: '2.25rem',
                  backgroundImage: 'url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTkiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaC00IHctNCBvcGFjaXR5LTUwIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PHBhdGggZD0ibTYgOSA2IDYgNi02Ij48L3BhdGg+PC9zdmc+)',
                  backgroundPosition: 'calc(100% - 0.75rem) 50%',
                  backgroundRepeat: 'no-repeat',
                  backgroundSize: '1rem',
                  border: '1px solid #e4e4e7',
                  borderRadius: 'calc(0.5rem - 0.125rem)',
                  cursor: 'pointer'
                }"
              >
                <template
                  x-data
                  x-for="(template, templateIndex) in $store.app.templates"
                >
                  <option
                    :value="templateIndex"
                    x-text="template.label"
                  ></option>
                </template>
              </select>

              <textarea
                rows="10"
                disabled="true"
                x-data
                :style="{
                  fontSize: '0.875rem',
                  fontWeight: '400',
                  lineHeight: '1.25rem',
                  color: '#09090b',
                  padding: '0.5rem 0.75rem',
                  resize: 'vertical'
                }"
                x-text="$store.app.getCurrentTemplate()"
              >
              </textarea>
            </div>
          </div>
          <div x-data x-show="$store.app.selectedTabIndex === 1">
            <div
              x-data
              :style="{
                display: 'flex',
                flexDirection: 'column',
                gap: '1rem' 
              }"
            >
              <div
                x-data
                :style="{
                  display: 'flex',
                  flexDirection: 'column',
                  gap: '0.5rem'
                }"
              >
                <template
                  x-data
                  x-for="(substitutionTag, substitutionTagIndex) in $store.app.substitutionTags"
                  x-effect="$store.app.substitutionTags = [{key:'agent_name',value:$store.auth.state?.user?.name || ''}]"
                >
                  <div
                    x-data
                    :style="{
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr 2.25rem',
                      gap: '0.5rem'
                    }"
                  >
                    <input
                      type="text"
                      name="key"
                      placeholder="key"
                      x-init="$nextTick(() => {
                        $el.focus()
                      })"
                      :disabled="!substitutionTag.editable"
                      x-model="substitutionTag.key"
                      :style="{
                        fontSize: '0.875rem',
                        fontWeight: '400',
                        lineHeight: '1.25rem',
                        color: '#09090b',
                        padding: '0.5rem 0.75rem',
                        border: '1px solid #e4e4e7',
                        borderRadius: 'calc(0.5rem - 0.125rem)',
                      }"
                    />
                    <input
                      type="text"
                      name="value"
                      placeholder="value"
                      x-model="substitutionTag.value"
                      :style="{
                        fontSize: '0.875rem',
                        fontWeight: '400',
                        lineHeight: '1.25rem',
                        color: '#09090b',
                        padding: '0.5rem 0.75rem',
                        border: '1px solid #e4e4e7',
                        borderRadius: 'calc(0.5rem - 0.125rem)',
                      }"
                    />
                    <template x-data x-if="substitutionTag.editable">
                      <button
                        type="button"
                        :style="{
                          display: 'inline-flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          width: '2.25rem',
                          height: '2.25rem',
                          fontSize: '0.875rem',
                          fontWeight: '400',
                          lineHeight: '1.25rem',
                          border: 'none',
                          backgroundColor: 'transparent',
                          cursor: 'pointer'
                        }"
                        @click="$store.app.deleteSubstituationTag(substitutionTagIndex)"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M3 6h18"></path>
                          <path
                            d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"
                          ></path>
                          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                          <line x1="10" x2="10" y1="11" y2="17"></line>
                          <line x1="14" x2="14" y1="11" y2="17"></line>
                        </svg>
                      </button>
                    </template>
                  </div>
                </template>
              </div>
              <button
                type="button"
                :style="{
                  display: 'inline-flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  height: '2.25rem',
                  fontSize: '0.875rem',
                  fontWeight: '400',
                  lineHeight: '1.25rem',
                  color: '#fafafa',
                  padding: '0.5rem 1rem',
                  backgroundColor: '#18181b',
                  border: '1px solid #e4e4e7',
                  borderRadius: 'calc(0.5rem - 0.125rem)',
                  cursor: 'pointer'
                }"
                @click="$store.app.addEmptySubstitutionTag()"
              >
                Set another key/value
              </button>
            </div>
          </div>
          <div x-data x-show="$store.app.selectedTabIndex === 2">
            <div
              x-data
              :style="{
                display: 'flex',
                flexDirection: 'column',
                gap: '1rem' 
              }"
            >
              <textarea
                rows="10"
                disabled="true"
                x-data
                :style="{
                  fontSize: '0.875rem',
                  fontWeight: '400',
                  lineHeight: '1.25rem',
                  color: '#09090b',
                  padding: '0.5rem 0.75rem',
                  resize: 'vertical'
                }"
                x-text="Handlebars.compile($store.app.getCurrentTemplate())($store.app.getCurrentSubstitutionContext())"
              ></textarea>

              <div
                x-data
                :style="{
                  display: 'flex',
                  gap: '0.5rem'
                }"
              >
                <select
                  x-data
                  x-model.number="$store.app.countryCode"
                  :style="{
                    width: '50%',
                    appearance: 'none',
                    fontSize: '0.875rem',
                    fontWeight: '400',
                    lineHeight: '1.25rem',
                    color: '#09090b',
                    padding: '0.5rem 0.75rem',
                    paddingRight: '2.25rem',
                    backgroundImage: 'url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTkiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iaC00IHctNCBvcGFjaXR5LTUwIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PHBhdGggZD0ibTYgOSA2IDYgNi02Ij48L3BhdGg+PC9zdmc+)',
                    backgroundPosition: 'calc(100% - 0.75rem) 50%',
                    backgroundRepeat: 'no-repeat',
                    backgroundSize: '1rem',
                    border: '1px solid #e4e4e7',
                    borderRadius: 'calc(0.5rem - 0.125rem)',
                    cursor: 'pointer'
                  }"
                >
                  <template
                    x-data
                    x-for="(country, countryIndex) in $store.app.countries"
                  >
                    <option
                      :value="country.value"
                      :selected="$store.app.countryCode === country.value"
                      x-text="country.label"
                    ></option>
                  </template>
                </select>
                <input
                  type="text"
                  x-data
                  x-model="$store.app.phoneNumber"
                  x-mask:dynamic="$store.app.countryCode === 57 ? '999 999 9999' : '9999999999'"
                  :style="{
                    width: '50%',
                    fontSize: '0.875rem',
                    fontWeight: '400',
                    lineHeight: '1.25rem',
                    color: '#09090b',
                    padding: '0.5rem 0.75rem',
                    border: '1px solid #e4e4e7',
                    borderRadius: 'calc(0.5rem - 0.125rem)',
                  }"
                />
              </div>

              <button
                type="button"
                :style="{
                  display: 'inline-flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  height: '2.25rem',
                  fontSize: '0.875rem',
                  fontWeight: '400',
                  lineHeight: '1.25rem',
                  color: '#fafafa',
                  padding: '0.5rem 1rem',
                  backgroundColor: '#18181b',
                  border: '1px solid #e4e4e7',
                  borderRadius: 'calc(0.5rem - 0.125rem)',
                  cursor: 'pointer'
                }"
                @click="$store.app.sendMessage()"
              >
                Submit
              </button>
            </div>
          </div>
        </div>
        <div
          x-data
          :style="{
            display: 'flex',
            justifyContent: 'flex-end'
          }"
        >
          <img
            src="https://dist.monitoreointeligente.informationsys.com/agentless-wa/logo-informationsystems.jpg"
            alt="Information Systems"
            width="150"
          />
        </div>
      </div>
      <div x-data x-show="$store.auth.status === 'error'" x-cloak>
        <span x-data x-text="$store.auth.error"></span>
      </div>
    </main>

    <script>
      window.__APP_NAME__ = "Genesys Whatsapp Demo";
      window.__APP_PLATFORM_ENV__ = "sae1.pure.cloud";
      window.__APP_PLATFORM_CLIENT_ID__ =
        "faacf95d-903f-4db1-b00a-ecd8697d57a0";
      window.__APP_WA_ACTION_URL__ =
        "https://ugtw8betcb.execute-api.sa-east-1.amazonaws.com/prodx/ConnectorWA-SendAgentless?jsoncallback=yes&task=sendMessage";
      window.__APP_PLATFORM_REDIRECT_URL__ = new URL(
        location.pathname,
        location
      ).href;
    </script>

    <script>
      document.addEventListener("alpine:init", () => {
        const platformClient = require("platformClient");
        const api = platformClient.ApiClient.instance;
        const usersApi = new platformClient.UsersApi();
        const searchParameters = new URLSearchParams(
          location.search.slice(1) || location.hash.slice(1)
        );

        api.setEnvironment(__APP_PLATFORM_ENV__);
        // Only for dev mode
        // api.setAccessToken(
        //   "BlpZ9K9RROC6rqS1TltfvAdTBtTI15M1xANFHuzO3d1eWUc2Zhr6edpPRhvoHvN7zUpV_XEZy7k30wxpY0IBVg"
        // );

        Alpine.store("auth", {
          async init() {
            const serverState = this.getServerState();
            const clientState = this.getClientState();

            try {
              if (serverState) {
                await api.loginImplicitGrant(
                  __APP_PLATFORM_CLIENT_ID__,
                  __APP_PLATFORM_REDIRECT_URL__
                );
                const user = await usersApi.getUsersMe();

                this.onAuthenticated({ ...serverState, user });
              } else {
                await api.loginImplicitGrant(
                  __APP_PLATFORM_CLIENT_ID__,
                  __APP_PLATFORM_REDIRECT_URL__,
                  { state: JSON.stringify(clientState) }
                );

                this.onAuthenticating();
              }
            } catch (error) {
              this.onError(error);
            }
          },
          state: undefined,
          error: null,
          status: "idle",
          getServerState() {
            return JSON.parse(
              decodeURIComponent(searchParameters.get("state"))
            );
          },
          getClientState() {
            return { appName: __APP_NAME__ };
          },
          onAuthenticated(state) {
            this.state = state;
            this.error = null;
            this.status = "success";
          },
          onAuthenticating() {
            this.state = undefined;
            this.error = null;
            this.status = "authenticating";
          },
          onError(error) {
            this.state = undefined;
            this.error = error.message;
            this.status = "error";
          },
        });
      });
    </script>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("tabs", (initSelectedTabIndex = 0) => ({
          selectedTabIndex: initSelectedTabIndex,
          setSelectedTabIndex(nextSelectedTabIndex) {
            this.selectedTabIndex = nextSelectedTabIndex;
          },
        }));
      });
    </script>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.store("app", {
          countries: [
            {
              label: "Afghanistan (+93)",
              value: 93,
            },
            {
              label: "Albania (+355)",
              value: 355,
            },
            {
              label: "Algeria (+213)",
              value: 213,
            },
            {
              label: "Andorra (+376)",
              value: 376,
            },
            {
              label: "Angola (+244)",
              value: 244,
            },
            {
              label: "Antigua and Barbuda (+1268)",
              value: 1268,
            },
            {
              label: "Argentina (+54)",
              value: 54,
            },
            {
              label: "Armenia (+374)",
              value: 374,
            },
            {
              label: "Aruba (+297)",
              value: 297,
            },
            {
              label: "Australia (+61)",
              value: 61,
            },
            {
              label: "Austria (+43)",
              value: 43,
            },
            {
              label: "Azerbaijan (+994)",
              value: 994,
            },
            {
              label: "Bahamas (+1242)",
              value: 1242,
            },
            {
              label: "Bahrain (+973)",
              value: 973,
            },
            {
              label: "Bangladesh (+880)",
              value: 880,
            },
            {
              label: "Barbados (+1246)",
              value: 1246,
            },
            {
              label: "Belarus (+375)",
              value: 375,
            },
            {
              label: "Belgium (+32)",
              value: 32,
            },
            {
              label: "Belize (+501)",
              value: 501,
            },
            {
              label: "Benin (+229)",
              value: 229,
            },
            {
              label: "Bhutan (+975)",
              value: 975,
            },
            {
              label: "Bolivia (+591)",
              value: 591,
            },
            {
              label: "Bosnia and Herzegovina (+387)",
              value: 387,
            },
            {
              label: "Botswana (+267)",
              value: 267,
            },
            {
              label: "Brazil (+55)",
              value: 55,
            },
            {
              label: "British Indian Ocean Territory (+246)",
              value: 246,
            },
            {
              label: "Brunei (+673)",
              value: 673,
            },
            {
              label: "Bulgaria (+359)",
              value: 359,
            },
            {
              label: "Burkina Faso (+226)",
              value: 226,
            },
            {
              label: "Burundi (+257)",
              value: 257,
            },
            {
              label: "Cambodia (+855)",
              value: 855,
            },
            {
              label: "Cameroon (+237)",
              value: 237,
            },
            {
              label: "Canada (+1)",
              value: 1,
            },
            {
              label: "Cape Verde (+238)",
              value: 238,
            },
            {
              label: "Caribbean Netherlands (+599)",
              value: 599,
            },
            {
              label: "Central African Republic (+236)",
              value: 236,
            },
            {
              label: "Chad (+235)",
              value: 235,
            },
            {
              label: "Chile (+56)",
              value: 56,
            },
            {
              label: "China (+86)",
              value: 86,
            },
            {
              label: "Colombia (+57)",
              value: 57,
            },
            {
              label: "Comoros (+269)",
              value: 269,
            },
            {
              label: "Congo (+243)",
              value: 243,
            },
            {
              label: "Congo (+242)",
              value: 242,
            },
            {
              label: "Costa Rica (+506)",
              value: 506,
            },
            {
              label: "Côte d'Ivoire (+225)",
              value: 225,
            },
            {
              label: "Croatia (+385)",
              value: 385,
            },
            {
              label: "Cuba (+53)",
              value: 53,
            },
            {
              label: "Curaçao (+599)",
              value: 599,
            },
            {
              label: "Cyprus (+357)",
              value: 357,
            },
            {
              label: "Czech Republic (+420)",
              value: 420,
            },
            {
              label: "Denmark (+45)",
              value: 45,
            },
            {
              label: "Djibouti (+253)",
              value: 253,
            },
            {
              label: "Dominica (+1767)",
              value: 1767,
            },
            {
              label: "Dominican Republic (+1)",
              value: 1,
            },
            {
              label: "Ecuador (+593)",
              value: 593,
            },
            {
              label: "Egypt (+20)",
              value: 20,
            },
            {
              label: "El Salvador (+503)",
              value: 503,
            },
            {
              label: "Equatorial Guinea (+240)",
              value: 240,
            },
            {
              label: "Eritrea (+291)",
              value: 291,
            },
            {
              label: "Estonia (+372)",
              value: 372,
            },
            {
              label: "Ethiopia (+251)",
              value: 251,
            },
            {
              label: "Fiji (+679)",
              value: 679,
            },
            {
              label: "Finland (+358)",
              value: 358,
            },
            {
              label: "France (+33)",
              value: 33,
            },
            {
              label: "French Guiana (+594)",
              value: 594,
            },
            {
              label: "French Polynesia (+689)",
              value: 689,
            },
            {
              label: "Gabon (+241)",
              value: 241,
            },
            {
              label: "Gambia (+220)",
              value: 220,
            },
            {
              label: "Georgia (+995)",
              value: 995,
            },
            {
              label: "Germany (+49)",
              value: 49,
            },
            {
              label: "Ghana (+233)",
              value: 233,
            },
            {
              label: "Greece (+30)",
              value: 30,
            },
            {
              label: "Grenada (+1473)",
              value: 1473,
            },
            {
              label: "Guadeloupe (+590)",
              value: 590,
            },
            {
              label: "Guam (+1671)",
              value: 1671,
            },
            {
              label: "Guatemala (+502)",
              value: 502,
            },
            {
              label: "Guinea (+224)",
              value: 224,
            },
            {
              label: "Guinea-Bissau (+245)",
              value: 245,
            },
            {
              label: "Guyana (+592)",
              value: 592,
            },
            {
              label: "Haiti (+509)",
              value: 509,
            },
            {
              label: "Honduras (+504)",
              value: 504,
            },
            {
              label: "Hong Kong (+852)",
              value: 852,
            },
            {
              label: "Hungary (+36)",
              value: 36,
            },
            {
              label: "Iceland (+354)",
              value: 354,
            },
            {
              label: "India (+91)",
              value: 91,
            },
            {
              label: "Indonesia (+62)",
              value: 62,
            },
            {
              label: "Iran (+98)",
              value: 98,
            },
            {
              label: "Iraq (+964)",
              value: 964,
            },
            {
              label: "Ireland (+353)",
              value: 353,
            },
            {
              label: "Israel (+972)",
              value: 972,
            },
            {
              label: "Italy (+39)",
              value: 39,
            },
            {
              label: "Jamaica (+1876)",
              value: 1876,
            },
            {
              label: "Japan (+81)",
              value: 81,
            },
            {
              label: "Jordan (+962)",
              value: 962,
            },
            {
              label: "Kazakhstan (+7)",
              value: 7,
            },
            {
              label: "Kenya (+254)",
              value: 254,
            },
            {
              label: "Kiribati (+686)",
              value: 686,
            },
            {
              label: "Kosovo (+383)",
              value: 383,
            },
            {
              label: "Kuwait (+965)",
              value: 965,
            },
            {
              label: "Kyrgyzstan (+996)",
              value: 996,
            },
            {
              label: "Laos (+856)",
              value: 856,
            },
            {
              label: "Latvia (+371)",
              value: 371,
            },
            {
              label: "Lebanon (+961)",
              value: 961,
            },
            {
              label: "Lesotho (+266)",
              value: 266,
            },
            {
              label: "Liberia (+231)",
              value: 231,
            },
            {
              label: "Libya (+218)",
              value: 218,
            },
            {
              label: "Liechtenstein (+423)",
              value: 423,
            },
            {
              label: "Lithuania (+370)",
              value: 370,
            },
            {
              label: "Luxembourg (+352)",
              value: 352,
            },
            {
              label: "Macau (+853)",
              value: 853,
            },
            {
              label: "Macedonia (+389)",
              value: 389,
            },
            {
              label: "Madagascar (+261)",
              value: 261,
            },
            {
              label: "Malawi (+265)",
              value: 265,
            },
            {
              label: "Malaysia (+60)",
              value: 60,
            },
            {
              label: "Maldives (+960)",
              value: 960,
            },
            {
              label: "Mali (+223)",
              value: 223,
            },
            {
              label: "Malta (+356)",
              value: 356,
            },
            {
              label: "Marshall Islands (+692)",
              value: 692,
            },
            {
              label: "Martinique (+596)",
              value: 596,
            },
            {
              label: "Mauritania (+222)",
              value: 222,
            },
            {
              label: "Mauritius (+230)",
              value: 230,
            },
            {
              label: "Mexico (+52)",
              value: 52,
            },
            {
              label: "Micronesia (+691)",
              value: 691,
            },
            {
              label: "Moldova (+373)",
              value: 373,
            },
            {
              label: "Monaco (+377)",
              value: 377,
            },
            {
              label: "Mongolia (+976)",
              value: 976,
            },
            {
              label: "Montenegro (+382)",
              value: 382,
            },
            {
              label: "Morocco (+212)",
              value: 212,
            },
            {
              label: "Mozambique (+258)",
              value: 258,
            },
            {
              label: "Myanmar (+95)",
              value: 95,
            },
            {
              label: "Namibia (+264)",
              value: 264,
            },
            {
              label: "Nauru (+674)",
              value: 674,
            },
            {
              label: "Nepal (+977)",
              value: 977,
            },
            {
              label: "Netherlands (+31)",
              value: 31,
            },
            {
              label: "New Caledonia (+687)",
              value: 687,
            },
            {
              label: "New Zealand (+64)",
              value: 64,
            },
            {
              label: "Nicaragua (+505)",
              value: 505,
            },
            {
              label: "Niger (+227)",
              value: 227,
            },
            {
              label: "Nigeria (+234)",
              value: 234,
            },
            {
              label: "North Korea (+850)",
              value: 850,
            },
            {
              label: "Norway (+47)",
              value: 47,
            },
            {
              label: "Oman (+968)",
              value: 968,
            },
            {
              label: "Pakistan (+92)",
              value: 92,
            },
            {
              label: "Palau (+680)",
              value: 680,
            },
            {
              label: "Palestine (+970)",
              value: 970,
            },
            {
              label: "Panama (+507)",
              value: 507,
            },
            {
              label: "Papua New Guinea (+675)",
              value: 675,
            },
            {
              label: "Paraguay (+595)",
              value: 595,
            },
            {
              label: "Peru (+51)",
              value: 51,
            },
            {
              label: "Philippines (+63)",
              value: 63,
            },
            {
              label: "Poland (+48)",
              value: 48,
            },
            {
              label: "Portugal (+351)",
              value: 351,
            },
            {
              label: "Puerto Rico (+1)",
              value: 1,
            },
            {
              label: "Qatar (+974)",
              value: 974,
            },
            {
              label: "Réunion (+262)",
              value: 262,
            },
            {
              label: "Romania (+40)",
              value: 40,
            },
            {
              label: "Russia (+7)",
              value: 7,
            },
            {
              label: "Rwanda (+250)",
              value: 250,
            },
            {
              label: "Saint Kitts and Nevis (+1869)",
              value: 1869,
            },
            {
              label: "Saint Lucia (+1758)",
              value: 1758,
            },
            {
              label: "Saint Vincent and the Grenadines (+1784)",
              value: 1784,
            },
            {
              label: "Samoa (+685)",
              value: 685,
            },
            {
              label: "San Marino (+378)",
              value: 378,
            },
            {
              label: "São Tomé and Príncipe (+239)",
              value: 239,
            },
            {
              label: "Saudi Arabia (+966)",
              value: 966,
            },
            {
              label: "Senegal (+221)",
              value: 221,
            },
            {
              label: "Serbia (+381)",
              value: 381,
            },
            {
              label: "Seychelles (+248)",
              value: 248,
            },
            {
              label: "Sierra Leone (+232)",
              value: 232,
            },
            {
              label: "Singapore (+65)",
              value: 65,
            },
            {
              label: "Slovakia (+421)",
              value: 421,
            },
            {
              label: "Slovenia (+386)",
              value: 386,
            },
            {
              label: "Solomon Islands (+677)",
              value: 677,
            },
            {
              label: "Somalia (+252)",
              value: 252,
            },
            {
              label: "South Africa (+27)",
              value: 27,
            },
            {
              label: "South Korea (+82)",
              value: 82,
            },
            {
              label: "South Sudan (+211)",
              value: 211,
            },
            {
              label: "Spain (+34)",
              value: 34,
            },
            {
              label: "Sri Lanka (+94)",
              value: 94,
            },
            {
              label: "Sudan (+249)",
              value: 249,
            },
            {
              label: "Suriname (+597)",
              value: 597,
            },
            {
              label: "Swaziland (+268)",
              value: 268,
            },
            {
              label: "Sweden (+46)",
              value: 46,
            },
            {
              label: "Switzerland (+41)",
              value: 41,
            },
            {
              label: "Syria (+963)",
              value: 963,
            },
            {
              label: "Taiwan (+886)",
              value: 886,
            },
            {
              label: "Tajikistan (+992)",
              value: 992,
            },
            {
              label: "Tanzania (+255)",
              value: 255,
            },
            {
              label: "Thailand (+66)",
              value: 66,
            },
            {
              label: "Timor-Leste (+670)",
              value: 670,
            },
            {
              label: "Togo (+228)",
              value: 228,
            },
            {
              label: "Tonga (+676)",
              value: 676,
            },
            {
              label: "Trinidad and Tobago (+1868)",
              value: 1868,
            },
            {
              label: "Tunisia (+216)",
              value: 216,
            },
            {
              label: "Turkey (+90)",
              value: 90,
            },
            {
              label: "Turkmenistan (+993)",
              value: 993,
            },
            {
              label: "Tuvalu (+688)",
              value: 688,
            },
            {
              label: "Uganda (+256)",
              value: 256,
            },
            {
              label: "Ukraine (+380)",
              value: 380,
            },
            {
              label: "United Arab Emirates (+971)",
              value: 971,
            },
            {
              label: "United Kingdom (+44)",
              value: 44,
            },
            {
              label: "United States (+1)",
              value: 1,
            },
            {
              label: "Uruguay (+598)",
              value: 598,
            },
            {
              label: "Uzbekistan (+998)",
              value: 998,
            },
            {
              label: "Vanuatu (+678)",
              value: 678,
            },
            {
              label: "Vatican City (+39)",
              value: 39,
            },
            {
              label: "Venezuela (+58)",
              value: 58,
            },
            {
              label: "Vietnam (+84)",
              value: 84,
            },
            {
              label: "Yemen (+967)",
              value: 967,
            },
            {
              label: "Zambia (+260)",
              value: 260,
            },
            {
              label: "Zimbabwe (+263)",
              value: 263,
            },
          ],
          countryCode: 57,
          phoneNumber: "",
          tabs: [
            { label: "Template selector", value: "TEMPLATE_SELECTOR" },
            { label: "Substitution tags", value: "SUBSTITUTION_TAGS" },
            { label: "Preview", value: "PREVIEW" },
          ],
          selectedTabIndex: 0,
          templates: [
            {
              label: "Plantilla - Iniciar Chat",
              value:
                "WhatsApp_Template_Header;iniciarchat;es_ES;3c47f583-41ca-4700-8362-ce9b2b9a3409;\n\nHola soy <<{{agent_name}}>> de Monitoreo Inteligente\n\nTenemos información importante para darte.\n¿Cómo estás hoy?",
            },
            {
              label: "Plantilla - Saludo genérico Meta WhatsApp",
              value:
                "WhatsApp_Template;hello_world;en_US;3c47f583-41ca-4700-8362-ce9b2b9a3409;\n\nWelcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.\n\nWhatsApp Business Platform sample message\n",
            },
            {
              label: "Plantilla - Saludo genérico Monitoreo Inteligente",
              value:
                "WhatsApp_Template;saludo;es_ES;3c47f583-41ca-4700-8362-ce9b2b9a3409;\n\nSomos Monitoreo Inteligente\n\nTenemos una información importante que darte.",
            },
          ],
          selectedTemplateIndex: 0,
          getCurrentTemplate() {
            return this.templates[this.selectedTemplateIndex].value;
          },
          substitutionTags: [],
          getCurrentSubstitutionContext() {
            return this.substitutionTags.reduce((output, substitutionTag) => {
              if (substitutionTag.key) {
                output[substitutionTag.key] = substitutionTag.value;
              }
              return output;
            }, {});
          },
          addEmptySubstitutionTag() {
            this.substitutionTags.push({
              key: "",
              value: "",
              editable: true,
            });
          },
          deleteSubstituationTag(substitutionTagIndex) {
            this.substitutionTags.splice(substitutionTagIndex, 1);
          },
          async sendMessage() {
            if (this.phoneNumber.length < 10) {
              window.alert(`Please enter a valid phone number`);
              return;
            }

            try {
              const rawMessage = Handlebars.compile(this.getCurrentTemplate())(
                this.getCurrentSubstitutionContext()
              );
              const toAddressMessengerType = "open";
              const fromAddress = `${rawMessage.split(";")[3]}`;
              const toAddress = `+${this.countryCode}${this.phoneNumber}`;
              const textBody = rawMessage;
              const payload = new URLSearchParams({
                fromAddress,
                toAddressMessengerType,
                toAddress,
                textBody,
              }).toString();
              const contentLength = new TextEncoder().encode(
                payload
              ).byteLength;
              await fetch(__APP_WA_ACTION_URL__, {
                method: "POST",
                mode: "no-cors",
                cache: "no-cache",
                headers: {
                  Origin:
                    "https://dist.monitoreointeligente.informationsys.com",
                  Referer:
                    "https://dist.monitoreointeligente.informationsys.com",
                  "Content-Type":
                    "application/x-www-form-urlencoded; charset=UTF-8",
                  "Content-Length": contentLength,
                },
                referrerPolicy: "no-referrer",
                body: payload,
              }).then((response) => {
                if (response.ok) return response.json();
                return Promise.reject(new Error(`Something went wrong`));
              });

              window.alert(`Message sent by Genesys Cloud`);
            } catch (e) {
              window.alert(e.message);
            }
          },
        });
      });
    </script>
  </body>
</html>
